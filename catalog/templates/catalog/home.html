{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANIMART üâê</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>

<!-- Header -->
<header class="store-header">
    <div class="store-logo">
        <span class="brand-name">ANIMART</span>
        <span class="cart-icon">üâê</span>
    </div>

    <div class="auth-links">
        {% if user.is_authenticated %}
            <span class="greeting">Hello, {{ user.username }}!</span>
            <form action="{% url 'logout' %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="auth-link logout-button">Logout</button>
            </form>
        {% else %}
            <a href="{% url 'login' %}" class="auth-link">Login</a> |
            <a href="{% url 'register' %}" class="auth-link">Register</a>
        {% endif %}
    </div>
</header>

<!-- Search -->
<div class="search-bar-container">
    <form action="{% url 'search_products' %}" method="GET" class="search-form">
        <input type="text" name="query" placeholder="Search for products..." class="search-input" required>
        <button type="submit" class="search-button">Search</button>
    </form>
</div>

<!-- Products Section -->
<section class="products-section">
    <h2 class="section-title">Explore Our Products</h2>

    <div class="products">
        {% for product in products %}
            <div class="product">
                <!-- Image Slider -->
                <div class="product-image-slider">
                    <div class="slider">
                        {% if product.images.exists %}
                            {% for image in product.images.all %}
                                <img src="{{ image.image.url }}" alt="{{ product.name }}">
                            {% endfor %}
                        {% else %}
                            <img src="{% static 'images/default.jpg' %}" alt="No image available">
                        {% endif %}
                    </div>
                    <button class="prev">&#10094;</button>
                    <button class="next">&#10095;</button>
                </div>

                <!-- Product Details -->
                <div class="product-details">
                    <h3>{{ product.name }}</h3>
                    <p>{{ product.description }}</p>
                    <p class="product-price">‚Ç¶ {{ product.price|floatformat:2 }}</p>

                    <!-- Add to Cart -->
                    <form action="{% url 'add_to_cart' product.id %}" method="POST">
                        {% csrf_token %}
                        <button type="submit" class="add-to-cart-btn">Add to Cart</button>
                    </form>
                </div>
            </div>
        {% empty %}
            <p class="no-products">No products found.</p>
        {% endfor %}
    </div>
</section>

<!-- Footer -->
<footer class="footer">
    <div class="footer-container">
        <p>&copy; 2025 ANIMART. All rights reserved.</p>
        <div class="footer-links">
            <a href="{% url 'privacy_policy' %}" class="footer-link">Privacy Policy</a>
            <a href="{% url 'terms_of_service' %}" class="footer-link">Terms of Service</a>
        </div>
    </div>
</footer>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const sliders = document.querySelectorAll(".product-image-slider");

    sliders.forEach(slider => {
        const slideContainer = slider.querySelector(".slider");
        const slides = slider.querySelectorAll("img");
        let currentIndex = 0;

        // Ensure slider always has at least one image
        if (slides.length <= 1) return;

        slider.querySelector(".prev").addEventListener("click", () => {
            currentIndex = (currentIndex > 0) ? currentIndex - 1 : slides.length - 1;
            slideContainer.style.transform = `translateX(-${currentIndex * 100}%)`;
        });

        slider.querySelector(".next").addEventListener("click", () => {
            currentIndex = (currentIndex < slides.length - 1) ? currentIndex + 1 : 0;
            slideContainer.style.transform = `translateX(-${currentIndex * 100}%)`;
        });
    });
});
</script>

</body>
</html>